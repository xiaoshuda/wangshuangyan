<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
    <title>Do It</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--jQuery References-->
    
    <script src="js/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.2.0.min.js" type="text/javascript"></script>

    <!--Theme-->
    <link href="css/jquery.mobile-1.3.1.css" rel="stylesheet" type="text/css" title="rocket-jqueryui">

    <!--Wijmo Widgets CSS-->
    <link href="css/jquery.wijmo-pro.all.3.20131.7.min.css" rel="stylesheet" type="text/css">

    <!--Wijmo Widgets JavaScript-->
    <script src="js/jquery.wijmo-open.all.3.20131.7.min.js" type="text/javascript"></script>
    <script src="js/jquery.wijmo-pro.all.3.20131.7.min.js" type="text/javascript"></script>
   
</head>
<body>
<div data-role="page" data-theme="c" id="i1">

	<div data-role="appviewpage" data-title="Overview">
            <div data-role="header" data-theme="d">
                <a href="index.html" data-ajax="false" data-icon="back">Back</a>
		<h4>这个清晰的世界</h4>
            </div>
            <div data-role="content">
		<h4>基于社交媒体的总体分析</h4>
		<div id="summary">
			<div data-role="fieldcontain">
				<label for="select-choice-1" class="select"><h4>信息类别:</h4></label>
				<select name="select-choice-1" id="select-choice-1">
					<option value="weibo">微博</option>
					<option value="luntan">论坛</option>			
				</select>
			</div>
			<div>
				<h4>广发银行：</h4>	
				<div id="wijpiechart" data-role="wijpiechart" class="ui-widget ui-widget-content ui-corner-all" >
			</div>		
		</div>
		
		 
	   </div>
          
	 

		<div data-role="footer" data-theme="d">
                <h4>这里是尾部信息～</h4>
         	</div>
	</div>
	<script type="text/javascript">
	//$( document ).delegate("#i1", "pageinit", function() {
		//$(document).bind('pageinit',function(){ 
		//$(document).bind('pagecreate',function(){
			$(document).ready(function () {
			

			$(document).bind( "pagebeforechange", beforechange);



				//$.mobile.ajaxLinksEnabled = false;
				alert("page is ready.......");
				var data1 = [{
					Device: '很好',
					Percent: 46.78,
					Offset: 15
				}, {
					Device: '还行',
					Percent: 23.18
				}, {
					Device: '一般',
					Percent: 20.25
				}, {
					Device: '不好',
					Percent: 5.41
				}, {
					Device: '非常差',
					Percent: 3.44
				}];

				var data2 = [{
					Device: '很好',
					Percent: 20.25,
					Offset: 15
				}, {
					Device: '还行',
					Percent: 5.41
				}, {
					Device: '一般',
					Percent: 20.25
				}, {
					Device: '不好',
					Percent: 46.78
				}, {
					Device: '非常差',
					Percent: 3.44
				}];
				//获得下拉列表的值
				
				$("#select-choice-1").change(function(){
					var listValue = $("#select-choice-1").val();
					//alert(listValue+".......");
					if(listValue == "weibo"){
					$("#wijpiechart").wijpiechart("option","header", { text: "对广发银行产品的总体印象——微博平台" })
						.wijpiechart("option","dataSource",data1);
					}else{
					$("#wijpiechart").wijpiechart("option","header", { text: "对广发银行产品的总体印象——论坛平台" })
						.wijpiechart("option","dataSource",data2);
					
					}
				
					
				});
				
				
				
				//$("#wijpiechart").wijpiechart("beginUpdate");
				$("#wijpiechart").wijpiechart({
					dataSource: data1,
					data: {
						label: { bind: "Device" },
						value: { bind: "Percent" },
						offset: { bind: "Offset" }
					},
					radius: 500,
					legend: { visible: true },
					hint: {
						content: function () {
							return this.data.label + " : " + Globalize.format(this.value / this.total, "p2");
						}
					},
					header: {
						text: "对广发银行产品的总体印象",
						visible:false
					},
				});
				//$("#wijpiechart").wijpiechart("endUpdate");

				$("#wijpiechart").wijpiechart({ 
					//pieChart上的click事件
					click : function (e, args) { 
						//alert($("#select-choice-1").val());
						var label = args.label;
						var index = args.index;
					    alert("当前选中的label为xxxxxx"+args.label+"....当前选中数据的位置....."+args.index+"...当前选中数....."+args.value);

						
						$.mobile.changePage( "a2.html", { 
							type:"post",
							data: {
								index:index,
								label:label
							}
							transition: "slideup"});
					}			
				
        					

						
						
				});
				
				 

			});
function beforechange( e, data ) {
if ( typeof data.toPage != "string" ) {
var url = $.mobile.path.parseUrl(e.target.baseURI),
re = /a2.html/;
	if(url.href.search(re) != -1){
		var page = $(e.target).find("#a2");
		var d = data.options.data.name;
		var pwd = data.options.data.psd;
		page.find("#s").append(decodeURIComponent(d)+decodeURIComponent(pwd));
	}
}
}
//转场页面dom加载完成后发生
function afterchange(e,data){
	//var d = data.options.data.name;
	alert("the change has happened........");
}

		</script>  


</div>
        
</body>
</html>
