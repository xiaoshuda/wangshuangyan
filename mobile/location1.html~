<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
    <title>IBM EB-3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">


 <link rel="stylesheet" media="all" href="css/jquery-jvectormap.css"/>
    <!--Theme-->
    <link href="css/jquery.mobile-1.3.1.css" rel="stylesheet" type="text/css" title="rocket-jqueryui">

    <!--Wijmo Widgets CSS-->
    <link href="css/jquery.wijmo-pro.all.3.20131.7.min.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script src="js/jquery.mobile-1.2.0.min.js" type="text/javascript"></script>


    <!--Wijmo Widgets JavaScript-->
    <script src="js/jquery.wijmo-open.all.3.20131.7.min.js" type="text/javascript"></script>
    <script src="js/jquery.wijmo-pro.all.3.20131.7.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.smint.js"></script>
<script src="js/jquery-jvectormap.js"></script>
  <script src="js/jquery-mousewheel.js"></script>
  <script src="js/lib/jvectormap.js"></script>
  <script src="js/lib/abstract-element.js"></script>
  <script src="js/lib/abstract-canvas-element.js"></script>
  <script src="js/lib/abstract-shape-element.js"></script>

  <script src="js/lib/svg-element.js"></script>
  <script src="js/lib/svg-group-element.js"></script>
  <script src="js/lib/svg-canvas-element.js"></script>
  <script src="js/lib/svg-shape-element.js"></script>
  <script src="js/lib/svg-path-element.js"></script>
  <script src="js/lib/svg-circle-element.js"></script>

  <script src="js/lib/vml-element.js"></script>
  <script src="js/lib/vml-group-element.js"></script>
  <script src="js/lib/vml-canvas-element.js"></script>
  <script src="js/lib/vml-shape-element.js"></script>
  <script src="js/lib/vml-path-element.js"></script>
  <script src="js/lib/vml-circle-element.js"></script>

  <script src="js/lib/vector-canvas.js"></script>
  <script src="js/lib/simple-scale.js"></script>
  <script src="js/lib/numeric-scale.js"></script>
  <script src="js/lib/ordinal-scale.js"></script>
  <script src="js/lib/color-scale.js"></script>
  <script src="js/lib/data-series.js"></script>
  <script src="js/lib/proj.js"></script>
  <script src="js/lib/world-map.js"></script>

  <script src="js/jquery-jvectormap-cn-mill-en.js"></script>


 <script type="text/javascript">
		$(document).bind('pageinit',function(){ 
			$(document).bind( "pagebeforechange", beforechange);
			$(document).bind("pagechange",afterchange);
		});
  </script>
</head>

<body>
<div data-role="page" data-theme="c" id="l1" data-position="fixed">
            <div data-role="header" data-theme="d" data-position="fixed">
                <a href="index.html" data-ajax="false" data-icon="back">Back</a>
		<h4>数据的地区分布</h4>
            </div>
            <div data-role="content">
		<div>
			<h4>微博数据的地图分布情况：</h4>	
			<div id="map1" style="width:100%;height:450px;" ></div>
			
		</div>
	    </div>
	   <div data-role="footer" data-theme="d" data-position="fixed">
                <h4>@IBM 深蓝-第3队</h4>
           </div>
<script type="text/javascript">
		//转场成功之前触发，
		function beforechange( e, data ) {
		}
		function afterchange(e,data){	

var provinceMap = {
        '西藏':'CN-54',
        '广州':'CN-52',
        '福建':'CN-35',
        '重庆':'CN-50',
        '四川':'CN-51',
        '上海':'CN-31',
        '江苏':'CN-32',
        '浙江':'CN-33',
        '山西':'CN-14',
        '内蒙古':'CN-15',
        '天津':'CN-12',
        '河北':'CN-13',
        '北京':'CN-11',
        '安徽':'CN-34',
        '云南':'CN-53',
        '江西':'CN-36',
        '山东':'CN-37',
        '河南':'CN-41',
        '湖南':'CN-43',
        '湖北':'CN-42',
        '广西':'CN-45',
        '广东':'CN-44',
        '海南':'CN-46',
        '新疆':'CN-65',
        '宁夏':'CN-64',
        '青海':'CN-63',
        '甘肃':'CN-62',
        '陕西':'CN-61',
        '黑龙江':'CN-23',
        '吉林':'CN-22',
        '辽宁':'CN-21'
    };

        $.ajax({
            url:'http://9.181.142.107:8082/FinalDemo/AndroidController',
            type:'post',
            data:{'flag':'analysis','keyWord':'location','load':'true'},
            success:function(data, textStatus, jqXHR){
                eval('var obj = '+ data);
                var param = {};
                for(var name in obj){
                    var provinceCode = provinceMap[name];
				    if(obj[name] >= 400){
				        param[provinceCode] = 5;
				    }else if(obj[name] >= 300){
				        param[provinceCode] = 4;
				    }else if(obj[name] >= 200){
				        param[provinceCode] = 3;
				    }else if(obj[name] >= 100){
				        param[provinceCode] = 2;
				    }else{
				        param[provinceCode] = 1;
				    }
                };
                //把数据分成5种情况，并用5种颜色进行显示
                $('#map1').vectorMap({
                    map: 'cn_mill_en',
		    backgroundColor: "#BBBBBB",
		    color: "#BBBBBB",
                    series: {
                        regions: [{
                            scale: {
		                        '1': '#66b361',
		                        '2': '#7f9a2b',
		                        '3': '#b3b23c',
		                        '4': '#b36b25',
		                        '5': '#b30507'
                            },
                            attribute: 'fill',
                            values: param
                        }]
                    },
		   regionsSelectable:true,
		   regionsSelectableOne:true,    
                    //设置选中地点颜色
		            regionStyle:{
		                selected: {
		                    fill: '#499dc3'
		                }
		            },
                        //当鼠标放在某一地点时显示该地点名称并显示评论数
		            onRegionLabelShow: function(event, label, code){
		                var currentName = '';
		                var currentNum = 0;
		                for(var name in provinceMap){
		                    if(code == provinceMap[name]){
		                        currentName = name;
		                        break;
		                    }
		                }
		                if(typeof(obj[name]) != 'undefined'){
		                    currentNum = obj[name];
		                }
		                label.html(
		                        currentName + ' ' +
		                        '评论数：' + currentNum
		                );
		            },
   			//点击某一地点时显示该地点的具体评论内容
		            onRegionSelected:function(event,code,isSelected,selectedRegions){
		                for(var name in provinceMap){
		                    if(code == provinceMap[name]){
		                        currentName = name;
		                        break;
		                    }
		                };
                            	alert("trun to another page");
					//页面转场跳转到location2.html,并将信息传递过去	
					     $.mobile.changePage( "location2.html", { 
							type: "get",
							data: {								
								location:currentName,
								flag:'analysis',
								keyWord:'location',
								load:'false'			
							},
							transition: "slideup"
					     });

		               
		            }/*End onRegionSelected function*/		            
            
                });/*End the map*/
            }/*End the ajax success function*/
        });/*End the ajax*/




}
</script>
</div><!--End Page--->


</body>
</html>
