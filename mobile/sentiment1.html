<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
    <title>IBM EB-3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--jQuery References-->
    
    <script src="js/jquery-1.8.2.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).bind("pageinit",function(){
	//$(document).bind( "pagebeforechange", beforechange);
	$(document).bind("pagechange",afterchange);
	console.log("pageinit");
});
/*$(document).bind("mobileinit", function() {
　　console.log("Please wait");
});*/
</script>
    <script src="js/jquery.mobile-1.2.0.min.js" type="text/javascript"></script>

    <!--Theme-->
    <link href="css/jquery.mobile-1.3.1.css" rel="stylesheet" type="text/css" title="rocket-jqueryui">

    <!--Wijmo Widgets CSS-->
    <link href="css/jquery.wijmo-pro.all.3.20131.7.min.css" rel="stylesheet" type="text/css">

    <!--Wijmo Widgets JavaScript-->
    <script src="js/jquery.wijmo-open.all.3.20131.7.min.js" type="text/javascript"></script>
    <script src="js/jquery.wijmo-pro.all.3.20131.7.min.js" type="text/javascript"></script>
  
</head>
<body>
<div data-role="page" data-theme="c" id="s1" data-mini="true" data-position="fixed">
            <div data-role="header" data-theme="d" data-position="fixed">
                <a href="index.html" data-ajax="false" data-icon="back">Back</a>
		<h4>情感偏好</h4>
            </div>
            <div data-role="content">
			<div data-role="fieldcontain" data-mini="true" id="first" style="height:30%；margin:0 auto;">
				<label for="select-choice-1" class="select"><h4>数据关键字:</h4></label>
				<select name="select-choice-1" id="select-choice-1">
					<option value="company">银行</option>
					<option value="industry">广发银行</option>			
				</select>
			</div>
			<div id="second" style="height:70%">			
				<div id="wijpiechart" data-role="wijpiechart" class="ui-widget ui-widget-content ui-corner-all" style="width: 100%;" >
				</div>
		 
	   		</div>
	</div>
	   <div data-role="footer" data-theme="d" data-position="fixed">
                <h4>@IBM 深蓝-第3队</h4>
           </div>
	<script type="text/javascript">
function afterchange(e,data){	
			
			
				//通过ajax返回数据填充pieChart
	$.ajax({
		type : "POST",
        url  : "pieData",
		//url  : "http://9.181.142.107:8082/FinalDemo/AndroidController",
		data : {'flag':'analysis','keyWord':'sentiment','load':'true'},
		success : function(data) {
			var result = eval("("+data+")");
			var company = result.company;
			var industry = result.industry;

				//获得下拉列表的值				
				$("#select-choice-1").change(function(){
					var listValue = $("#select-choice-1").val();
					//alert(listValue+".......");
					if(listValue == "company"){
					$("#wijpiechart").wijpiechart("option","header", { text: "社交媒体对银行的总体印象" })
						.wijpiechart("option","dataSource",company);
					}else{
					$("#wijpiechart").wijpiechart("option","header", { text: "社交媒体对广发银行的总体印象" })
						.wijpiechart("option","dataSource",industry);
					
					}
				
					
				});				
				//$("#wijpiechart").wijpiechart("beginUpdate");
				$("#wijpiechart").wijpiechart({
					radius: 140,
					innerRadius: 40,
					showChartLabels: false,
					hint: {
						content: function () {
							return this.data.label + " : " + Globalize.format(this.value / this.total, "p2");
						}
					},
					legend: {
						text: "",
						visible:true
					},
					header: {
						text: "社交媒体对银行的情感偏向",
						visible:true
					},						
					//seriesList:data1
					dataSource: company,
					data: {
						label: { bind: "label" },
						value: { bind: "data" }
						//offset: { bind: "Offset" }
					}
				});
				//$("#wijpiechart").wijpiechart("endUpdate");

				$("#wijpiechart").wijpiechart({ 
					//pieChart上的click事件
					click : function (e, args) { 						
						var emotion = args.label;//通过args获取饼图参数
					    //alert("当前选中的情感为'"+args.label+"'；\n将跳转至情感为'"+args.label+"'对应的数据页面中.....");

					//页面转场跳转到sentiment2.html,并将信息传递过去	
					     $.mobile.changePage( "sentiment2.html", { 
							type: "get",
							data: {
								name:"chufei",
								emotion:emotion			
							},
							transition: "slideup"
					     });

					}
						
				});
		},
		error:function(data){
			alert("error................");
		},
		dataType : "text"
	});
}
</script>  


</div><!--End Page--->
        
</body>
</html>
